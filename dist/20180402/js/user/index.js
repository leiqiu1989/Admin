define("user/index",["common","api","underscore","../../tpl/user/index","../../tpl/user/add"],function(e,t,n){"use strict";var i=e("common"),a=e("api");e("underscore");var r={index:e("../../tpl/user/index"),add:e("../../tpl/user/add")},d=function(){};$.extend(d.prototype,{init:function(){i.renderContent(r.index),this.initTree(),this.initTable(),this.event()},initTree:function(){var e={},t=[{name:"父节点1 - 展开",open:!0,children:[{name:"父节点11 - 折叠",children:[{name:"叶子节点111"},{name:"叶子节点112"},{name:"叶子节点113"},{name:"叶子节点114"}]},{name:"父节点12 - 折叠",children:[{name:"叶子节点121"},{name:"叶子节点122"},{name:"叶子节点123"},{name:"叶子节点124"}]},{name:"父节点13 - 没有子节点",isParent:!0}]},{name:"父节点2 - 折叠",children:[{name:"父节点21 - 展开",open:!0,children:[{name:"叶子节点211"},{name:"叶子节点212"},{name:"叶子节点213"},{name:"叶子节点214"}]},{name:"父节点22 - 折叠",children:[{name:"叶子节点221"},{name:"叶子节点222"},{name:"叶子节点223"},{name:"叶子节点224"}]},{name:"父节点23 - 折叠",children:[{name:"叶子节点231"},{name:"叶子节点232"},{name:"叶子节点233"},{name:"叶子节点234"}]}]},{name:"父节点3 - 没有子节点",isParent:!0}];$.fn.zTree.init($("#tree"),e,t)},initTable:function(){var e=this;layui.use(["table"],function(){var t=layui.table;t.render({elem:"#userTbList",url:a.getUserList,page:!0,cols:[[{title:"",field:"Id",type:"checkbox"},{title:"登录名",field:"UserId",width:100},{title:"姓名",field:"UserName",width:120},{title:"部门",field:"DepartmentName"},{title:"是否启用",field:"IsAble",width:100,templet:function(e){return e.IsAble?"是":"否"}},{title:"是否改密",field:"IfChangePwd",width:100,templet:function(e){return e.IsAble?"是":"否"}},{title:"添加时间",field:"AddDate",width:160},{title:"描述",field:"Description"}]]}),e.table=t})},editDialog:function(e){var t=this;e=e||{};var n=_.isEmpty(e),d=template.compile(r.add)($.extend(e,{isAdd:n})),l=n?"新增用户信息":"编辑用户信息";i.layUIDialog({title:l,type:1,content:d,area:["550px","570px"],success:function(n,r){i.setRadioCheckValue(n,[':radio[name="IsAble"][value="'+e.IsAble+'"]',':radio[name="IfChangePwd"][value="'+e.IfChangePwd+'"]']),$(n).find(".js-selectDept").on("click",function(){i.layUIDialog({title:"部门选择",type:1,content:'<div id="dialogDept" class="ztree"></div>',area:["300px","500px"],success:function(e){i.initTree({url:a.getDepartMent,param:{},treeId:"dialogDept",idKey:"Id",pIdKey:"ParentId",name:"DepartmentName",hasSearchClick:!1,expandFlag:!0,checkEnable:!0,dataFilter:function(e){return _.map(e,function(e,t){return e.nocheck=!e.LastLeaf,e})}})},btnAlign:"r",btn:["确 定","关 闭"],yes:function(e){var t=$.fn.zTree.getZTreeObj("dialogDept"),a=t.getCheckedNodes(!0),r=a.length,d=r>0?_.map(a,function(e){return e.DepartmentName}):"",l=r>0?_.map(a,function(e){return e.Id}):"";i.$(':text[name="DepartmentName"]',n).val(d.join()),i.$(':hidden[name="DepartmentId"]',n).val(l.join()),layer.close(e)},btn2:function(e){layer.close(e)}})}),i.renderForm(function(e){e.on("submit(*)",function(e){var n=e.field,d=n.Id?a.editUser:a.addUser;return i.ajax(d,JSON.stringify(n),function(e){e&&e.success&&(layer.close(r),t.table.reload("userTbList"))},{type:"POST",contentType:"application/json;charset=utf-8"}),!1})})}})},getUserByUserId:function(e){var t=this;i.ajax(a.getUserByUserId,{id:e},function(e){if(e&&e.IsSuccess){var n=e.Data;t.editDialog(n)}})},event:function(){var e=this;$("#content").off().on("click",".js-add",function(){e.editDialog()}).on("click",".js-edit",function(){var t=i.getSelectedRow(e.table,"userTbList");t.success&&e.editDialog(t.data)}).on("click",".js-del",function(){var t=i.getSelectedRow(e.table,"userTbList");t.success&&i.layConfirm("确定删除该该用户?",function(){i.ajax(a.deleteUser,{idList:t.data.Id},function(t){t&&t.success&&e.table.reload("userTbList")})})})}});var l=new d;t.init=function(){l.init()}});